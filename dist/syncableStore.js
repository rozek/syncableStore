!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@syncedstore/core")):"function"==typeof define&&define.amd?define(["exports","@syncedstore/core"],t):(e="undefined"!=typeof globalThis?globalThis:e||self,function(){var n=e.syncableStore,r=e.syncableStore={};t(r,e.core),r.noConflict=function(){return e.syncableStore=n,r}}())}(this,(function(e,t){"use strict";const n=new WeakMap;function r(e){const r=n.get(e);if(null==r)throw new Error('NoSuchStore: the given object is not a valid "SyncableStore"');return t.getYjsDoc(r)}const o=new WeakMap;function c(e,n,r){const u=e._item?.parent||e._start?.parent||t.getYjsValue(n);if(null==u._start){let n=o.get(u),c=Object.keys(n).find((r=>t.getYjsValue(n[r])===e));r.set(n,[c])}else c(u,n,r)}function u(e){(Array.isArray(e)?e:Object.values(e)).forEach((e=>{const n=t.getYjsValue(e);null!=n&&(o.set(n,e),u(e))}))}Object.defineProperty(e,"Box",{enumerable:!0,get:function(){return t.Box}}),Object.defineProperty(e,"SyncedArray",{enumerable:!0,get:function(){return t.SyncedArray}}),Object.defineProperty(e,"SyncedDoc",{enumerable:!0,get:function(){return t.SyncedDoc}}),Object.defineProperty(e,"SyncedMap",{enumerable:!0,get:function(){return t.SyncedMap}}),Object.defineProperty(e,"SyncedText",{enumerable:!0,get:function(){return t.SyncedText}}),Object.defineProperty(e,"SyncedXml",{enumerable:!0,get:function(){return t.SyncedXml}}),Object.defineProperty(e,"Y",{enumerable:!0,get:function(){return t.Y}}),Object.defineProperty(e,"areSame",{enumerable:!0,get:function(){return t.areSame}}),Object.defineProperty(e,"boxed",{enumerable:!0,get:function(){return t.boxed}}),Object.defineProperty(e,"getYjsValue",{enumerable:!0,get:function(){return t.getYjsValue}}),e.getYjsDoc=r,e.syncableStore=function(e,r=!1,s){const l=t.syncedStore({Root:{}},s),a=l.Root;return n.set(a,l),o.set(t.getYjsValue(a),a),null!=e&&t.observeDeep(a,((...n)=>function(e,n,r,s){const l=new Map;e.changed.forEach(((e,s)=>{let a=function(e,n){const r=o.get(e);if(null!=r)return r;const c=e._item?.parent||e._start?.parent||t.getYjsValue(n);if(null==c)throw new Error("NoRegisteredRoot: the given store root has no Yjs counterpart");const s=o.get(c);if(null==s)return;let l;if(Array.isArray(s))l=s.find((n=>t.getYjsValue(n)===e));else{const n=e._item?.parentSub;l="string"==typeof n?s[n]:s.values().find((n=>t.getYjsValue(n)===e))}null!=l&&(o.set(e,l),u(l));return l}(s,n);if(null!=a)if(Array.isArray(a)&&r)c(s,n,l);else if(0===e.size)u(a),l.set(a,[]);else{for(let n of e){const e=a[n],r=t.getYjsValue(e);null!=r&&(o.set(r,e),u(e))}l.set(a,Array.from(e.values()).filter((e=>null!=e)))}})),s(l)}(n[1],a,r,e))),l.Root},e.transact=function(e,t){const n=r(e);if(null==n)throw new Error('NoYjsDoc: no Yjs document for the given "SyncableStore" found');n.transact(t)},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=syncableStore.js.map
