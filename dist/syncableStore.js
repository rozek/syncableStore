!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@syncedstore/core")):"function"==typeof define&&define.amd?define(["exports","@syncedstore/core"],t):(e="undefined"!=typeof globalThis?globalThis:e||self,function(){var n=e.syncableStore,r=e.syncableStore={};t(r,e.core),r.noConflict=function(){return e.syncableStore=n,r}}())}(this,(function(e,t){"use strict";var n=new WeakMap;function r(e){var r=n.get(e);if(null==r)throw new Error('NoSuchStore: the given object is not a valid "SyncableStore"');return t.getYjsDoc(r)}var o=new WeakMap;function u(e,n,r){var a,i,l=(null===(a=e._item)||void 0===a?void 0:a.parent)||(null===(i=e._start)||void 0===i?void 0:i.parent)||t.getYjsValue(n);if(null==l._start){var c=o.get(l),f=Object.keys(c).find((function(n){return t.getYjsValue(c[n])===e}));r.set(c,[f])}else u(l,n,r)}function a(e){(Array.isArray(e)?e:Object.values(e)).forEach((function(e){var n=t.getYjsValue(e);null!=n&&(o.set(n,e),a(e))}))}Object.defineProperty(e,"Box",{enumerable:!0,get:function(){return t.Box}}),Object.defineProperty(e,"SyncedArray",{enumerable:!0,get:function(){return t.SyncedArray}}),Object.defineProperty(e,"SyncedMap",{enumerable:!0,get:function(){return t.SyncedMap}}),Object.defineProperty(e,"SyncedText",{enumerable:!0,get:function(){return t.SyncedText}}),Object.defineProperty(e,"SyncedXml",{enumerable:!0,get:function(){return t.SyncedXml}}),Object.defineProperty(e,"Y",{enumerable:!0,get:function(){return t.Y}}),Object.defineProperty(e,"areSame",{enumerable:!0,get:function(){return t.areSame}}),Object.defineProperty(e,"boxed",{enumerable:!0,get:function(){return t.boxed}}),Object.defineProperty(e,"getYjsValue",{enumerable:!0,get:function(){return t.getYjsValue}}),e.getYjsDoc=r,e.syncableStore=function(e,r,i){void 0===r&&(r=!1);var l=t.syncedStore({Root:{}},i),c=l.Root;return n.set(c,l),o.set(t.getYjsValue(c),c),null!=e&&t.observeDeep(c,(function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return function(e,n,r,i){var l=new Map;e.changed.forEach((function(e,i){var c=function(e,n){var r,u,i,l=o.get(e);if(null!=l)return l;var c=(null===(r=e._item)||void 0===r?void 0:r.parent)||(null===(u=e._start)||void 0===u?void 0:u.parent)||t.getYjsValue(n);if(null==c)throw new Error("NoRegisteredRoot: the given store root has no Yjs counterpart");var f=o.get(c);if(null==f)return;var s=void 0;if(Array.isArray(f))s=f.find((function(n){return t.getYjsValue(n)===e}));else{var d=null===(i=e._item)||void 0===i?void 0:i.parentSub;s="string"==typeof d?f[d]:f.values().find((function(n){return t.getYjsValue(n)===e}))}null!=s&&(o.set(e,s),a(s));return s}(i,n);if(null!=c)if(Array.isArray(c)&&r)u(i,n,l);else if(0===e.size)a(c),l.set(c,[]);else{for(var f=0,s=e;f<s.length;f++){var d=c[s[f]],y=t.getYjsValue(d);null!=y&&(o.set(y,d),a(d))}l.set(c,Array.from(e.values()).filter((function(e){return null!=e})))}})),i(l)}(n[1],c,r,e)})),l.Root},e.transact=function(e,t){var n=r(e);if(null==n)throw new Error('NoYjsDoc: no Yjs document for the given "SyncableStore" found');n.transact(t)},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=syncableStore.js.map
