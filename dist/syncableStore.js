!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@syncedstore/core")):"function"==typeof define&&define.amd?define(["exports","@syncedstore/core"],n):(e="undefined"!=typeof globalThis?globalThis:e||self,function(){var t=e.syncableStore,r=e.syncableStore={};n(r,e.core),r.noConflict=function(){return e.syncableStore=t,r}}())}(this,(function(e,n){"use strict";var t=new WeakMap;function r(e){var r=t.get(e);if(null==r)throw new Error('NoSuchStore: the given object is not a valid "SyncableStore"');return n.getYjsDoc(r)}var o=new WeakMap;function u(e,t,r){var a,i,l=(null===(a=e._item)||void 0===a?void 0:a.parent)||(null===(i=e._start)||void 0===i?void 0:i.parent)||n.getYjsValue(t);if(null==l._start){var c=o.get(l),f=Object.keys(c).find((function(t){return n.getYjsValue(c[t])===e}));r.set(c,[f])}else u(l,t,r)}function a(e){(Array.isArray(e)?e:Object.values(e)).forEach((function(e){var t=n.getYjsValue(e);null!=t&&(o.set(t,e),a(e))}))}Object.defineProperty(e,"Box",{enumerable:!0,get:function(){return n.Box}}),Object.defineProperty(e,"SyncedArray",{enumerable:!0,get:function(){return n.SyncedArray}}),Object.defineProperty(e,"SyncedDoc",{enumerable:!0,get:function(){return n.SyncedDoc}}),Object.defineProperty(e,"SyncedMap",{enumerable:!0,get:function(){return n.SyncedMap}}),Object.defineProperty(e,"SyncedText",{enumerable:!0,get:function(){return n.SyncedText}}),Object.defineProperty(e,"SyncedXml",{enumerable:!0,get:function(){return n.SyncedXml}}),Object.defineProperty(e,"Y",{enumerable:!0,get:function(){return n.Y}}),Object.defineProperty(e,"areSame",{enumerable:!0,get:function(){return n.areSame}}),Object.defineProperty(e,"boxed",{enumerable:!0,get:function(){return n.boxed}}),Object.defineProperty(e,"getYjsValue",{enumerable:!0,get:function(){return n.getYjsValue}}),e.getYjsDoc=r,e.syncableStore=function(e,r,i){void 0===r&&(r=!1);var l=n.syncedStore({Root:{}},i),c=l.Root;return t.set(c,l),o.set(n.getYjsValue(c),c),null!=e&&n.observeDeep(c,(function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return function(e,t,r,i){var l=new Map;e.changed.forEach((function(e,i){var c=function(e,t){var r,u,i,l=o.get(e);if(null!=l)return l;var c=(null===(r=e._item)||void 0===r?void 0:r.parent)||(null===(u=e._start)||void 0===u?void 0:u.parent)||n.getYjsValue(t);if(null==c)throw new Error("NoRegisteredRoot: the given store root has no Yjs counterpart");var f=o.get(c);if(null==f)return;var s=void 0;if(Array.isArray(f))s=f.find((function(t){return n.getYjsValue(t)===e}));else{var d=null===(i=e._item)||void 0===i?void 0:i.parentSub;s="string"==typeof d?f[d]:f.values().find((function(t){return n.getYjsValue(t)===e}))}null!=s&&(o.set(e,s),a(s));return s}(i,t);if(null!=c)if(Array.isArray(c)&&r)u(i,t,l);else if(0===e.size)a(c),l.set(c,[]);else{for(var f=0,s=e;f<s.length;f++){var d=c[s[f]],y=n.getYjsValue(d);null!=y&&(o.set(y,d),a(d))}l.set(c,Array.from(e.values()).filter((function(e){return null!=e})))}})),i(l)}(t[1],c,r,e)})),l.Root},e.transact=function(e,n){var t=r(e);if(null==t)throw new Error('NoYjsDoc: no Yjs document for the given "SyncableStore" found');t.transact(n)},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=syncableStore.js.map
